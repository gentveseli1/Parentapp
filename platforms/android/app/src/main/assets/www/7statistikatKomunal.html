
<script src="js/base_urlJS.js"></script>
<script src="js/includeJS.js"></script>
<script src="js/pulltorefresh.js"></script>
<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Heebo:300,400,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="css/styles5.css" type="text/css">
        <link rel="stylesheet" href="css/sidebar.css" type="text/css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src='https://kit.fontawesome.com/a076d05399.js'></script>

	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="https://code.highcharts.com/modules/export-data.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.13/moment-timezone-with-data-2012-2022.min.js"></script>
  <title>STATISTIKAT.MOB</title>
</head>
<body>
    <div class="loading" style="display:none">Loading&#8230;</div>

	<div class="container" id="container-fluid">
    <div inculdeWithHTML="sidebar.html"></div>

        <div class="nav d-flex mt-5" style="justify-content: center;margin-bottom:5px">
            <a href="6statistikat.html" class="btn btn-raporti">Raporti Prinderor</a>
        </div>

		<div class="nav d-flex" style="justify-content: center">
		  <button type="button" id="hyrje" style="margin-right:5px" class="btn inOut" value="entries" onclick="">Hyrjet</button>
		  <button type="button" id="dalje" class="btn inOut" value="exits" onclick="">Daljet</button>
		</div>

		<div class="statistic" align="center">
			<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
			<div id="containerMonthly" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
		</div>
	</div>
</body>
<footer>
	<script src="js/sidebar.js"></script>
    <script type="text/javascript">
    $('.inOut').click(function(){
            $('.loading').show();
            if(this.value == "entries"){
                $("#hyrje").addClass("colored")
                $("#dalje").removeClass("colored")
            }else{
                $("#hyrje").removeClass("colored")
                $("#dalje").addClass("colored")
            }

            setTimeout(() => {
                changeHyrjeDalje(this.value)
            }, 0);
        });

	document.querySelector("#hyrje").classList.add("colored")
        var token = localStorage.getItem('token')
    
        if(token==null){
            window.location.href='index.html';
        }
        var url = globalURL+'';
        var graph_data = []; 
        var graph_data_monthly = [];
        var student_id=null;
        var inOut='hyrje';
        
        var ditetWeekly;
        var ditetMonthly;
        var chart1;
        var chart2;
        var i;
        function changeHyrjeDalje(values) {
            if(values == "entries"){
                document.querySelector("#hyrje").classList.add("colored")
                document.querySelector("#dalje").classList.remove("colored")
            }else{
                document.querySelector("#hyrje").classList.remove("colored")
                document.querySelector("#dalje").classList.add("colored")
            }
            $.ajax({
                
                url: url+'weekly_report_'+values+'_niveli_komunal' ,
                type: "POST",
                headers:{
                'Authorization': 'Bearer ' + token,
                'Accept' : 'application/json',
                },
                async: false,
                success: function (data) {
                for(var i=0;i < data.length; i++){
                    graph_data[i] = data[i]
                }
                
                ditetWeekly = checkDitet(graph_data);

                for(i=0;i < graph_data.length; i++){
                    for(var j = 0 ; j<graph_data[i]['data'].length ; j++)
                    {
                        chart1.series[i].data[j].update(graph_data[i]['data'][j])
                    }
                }
                var tituliEnd = values;
                    if(tituliEnd == 'entries'){
                        tituliEnd = 'Hyrjeve';
                    }else if(tituliEnd == 'exits'){
                        tituliEnd = 'Daljeve'
                    }
                    chart1.setTitle({text: "Raporti Javor i "+tituliEnd});
                    chart2.setTitle({text: "Raporti Mujor i "+tituliEnd});
                    $('.loading').hide();
                
            },
            error: function (error) {
                }
            })
            $.ajax({
                url: url+'monthly_report_'+values+'_niveli_komunal' ,
                type: "POST",
                headers:{
                'Authorization': 'Bearer ' + token,
                'Accept' : 'application/json',
                },
                async: false,
                success: function (data) {
                for(var i=0;i < data.length; i++){
                    graph_data[i] = data[i]
                }
                console.log(graph_data)
                
                ditetWeekly = checkDitet(graph_data);
                
                for(i=0;i < graph_data.length; i++){
                    for(var j = 0 ; j<graph_data[i]['data'].length ; j++)
                    {
                        chart2.series[i].data[j].update(graph_data[i]['data'][j])
                    }
                }
            },
            error: function (error) {
                }
            })
        }
        $.ajax({
            url: url+'weekly_report_entries_niveli_komunal',
            type: 'POST',
            headers:{
                'Authorization': 'Bearer ' + token,
                'Accept' : 'application/json',
            },
            async: false,
            success: function (data) {
                for(var i=0;i < data.length; i++){
                    graph_data[i] = data[i]
                }
                
                ditetWeekly = checkDitet(graph_data);
            },
            error: function (error) {
            }
        });
        $.ajax({
            url: url+'monthly_report_entries_niveli_komunal',
            type: 'POST',
            headers:{
                'Authorization': 'Bearer ' + token,
                'Accept' : 'application/json',
            },
            async: false,
            success: function (data) {
                for(var i=0;i < data.length; i++){
                    graph_data_monthly[i] = data[i]
                }
                
                ditetMonthly = checkDitet(graph_data_monthly);
            },
            error: function (error) {
            }
        });
        function checkDitet(data){
            if(data[0]['data'].length <=5){
                    return  [
                        'Hane',
                        'Marte',
                        'Merkure',
                        'Enjte',
                        'Premte',
                        'Shtune',
                        'Diele'
                    ]
                }else{
                    return  [
                        '1',
                        '2',
                        '3',
                        '4',
                        '5',
                        '6',
                        '7',
                        '8',
                        '9',
                        '10',
                        '11',
                        '12',
                        '13',
                        '14',
                        '15',
                        '16',
                        '17',
                        '18',
                        '19',
                        '20',
                        '21',
                        '22',
                        '23',
                        '24',
                        '25',
                        '26',
                        '27',
                        '28',
                        '29',
                        '30',
                        '31'
                        
                    ]
                }
        }
        var data = graph_data
        function toTimestamp(timeUnformatted) {
            timeUnformatted = timeUnformatted < 10 ? ("0" + timeUnformatted) : timeUnformatted.toString();
            var timeFormatted = Date.parse("1-1-1 " + timeUnformatted.replace(".", ":") + ":00") - Date.parse("1-1-1 00:00:00");
            return timeFormatted;
        }
       
        function addZero(number){
            if(number == 0){
                return 'Mungoi'
            }
            number = number.toString().replace('.',':');
            if(number.substr(0,number.indexOf(':')).length == 1){
                number = "0"+number;
            }
            if(number.substr(number.indexOf(':')+1).length == 1){
                number = number+"0";
            }
            return number
        }
        var total = [],
        outOfTotal = [];
        chart1 = new Highcharts.chart('container', {
            exporting: {
                enabled: false
            },
            time: {
                timezone: 'Europe/Berlin'
            },
            chart: {
                type: 'areaspline'
            },
            title: {
                text: 'Raporti Javor i Daljeve'
            },
            legend: {
                layout: 'vertical',
                align: 'left',
                verticalAlign: 'top',
                x: 150,
                y: 100,
                floating: true,
                borderWidth: 1,
                backgroundColor:
                    Highcharts.defaultOptions.legend.backgroundColor || '#FFFFFF'
            },
            xAxis: {
                categories: this.ditetWeekly,
                plotBands: [{ // visualize the weekend
                    from: 4.5,
                    to: 6.5,
                    color: 'rgba(68, 170, 213, .2)'
                }]
            },
            tooltip: {
                shared: true,
                formatter: function(){
                    var x = "";
                    $.each(this.points, function(i, point) {
                         x +='<b>'+point.series.name+'</b> <br> Ora = ' + addZero(this.y)+ '<br>';             
                    });
                    return x;
                }
            },
            yAxis: {
                tickInterval: 1,
                breaks: [{
                    from: 1,
                    to: 6,
                }],
                labels: {
                        //format: '{value}'
                        
                        // formatter: function(){
                        //  return addZero(this.value.toString().replace('.',':'))
                        // }
                },
                title:{
                    text: "Ora"
                },
            },
            credits: {
                enabled: false
            },
            
            plotOptions: {
                areaspline: {
                    fillOpacity: 0.5
                },
                
            },
            series: graph_data
            
        });
        chart2 = new Highcharts.chart('containerMonthly', {
            exporting: {
                enabled: false
            },
            time: {
                timezone: 'Europe/Berlin'
            },
            chart: {
                type: 'areaspline',
                scrollablePlotArea: {
                    minWidth: 700,
                    scrollPositionX: 1
                }
            },
            title: {
                text: 'Raporti Mujor i Hyrjeve'
            },
            
            legend: {
                layout: 'vertical',
                align: 'left',
                verticalAlign: 'top',
                x: 150,
                y: 100,
                floating: true,
                borderWidth: 1,
                backgroundColor:
                    Highcharts.defaultOptions.legend.backgroundColor || '#FFFFFF'
            },
            xAxis: {
                tickWidth: 1,
                lineWidth: 1,
                opposite: true,
                max: 31,
                labels:{
                    overflow: 'justify'
                },
                tickLength: 0,
                categories: this.ditetMonthly,
            },
            tooltip: {
                shared: true,
                formatter: function(){
                    var x = "<b>Data: </b>"+this.x+"<br>";
                    $.each(this.points, function(i, point) {
                         x +='<b>'+point.series.name+'</b> <br> Ora = ' + addZero(this.y)+ '<br>';             
                    });
                    return x;
                },
                style:{
                    fontSize: "10px",
                },
            },
            yAxis: {
                labels: {
                        format: '{value}'
                },
                title:{
                    text: "Ora"
                },
            },
            credits: {
                enabled: false
            },
            
            plotOptions: {
                areaspline: {
                    fillOpacity: 0.5
                },
                
            },
            series: graph_data_monthly
            
        });
        $.ajax({
            url: globalURL+'profiles',
            type: 'POST',
            headers:{
            'Authorization': 'Bearer ' + token,
            'Accept' : 'application/json',
            },
            success: function (data) {
                data.forEach(row => {
                    $('.student').append('<button id="'+row.id+'" type="button" class="btn formkyqu mrgright studentId">'+row.name+'</button>');
                });
            },
            error: function (error) {
            }
        });
        PullToRefresh.init({
          mainElement: '#container-fluid', // above which element?
          onRefresh: function(){
            var promise = new Promise(
              function(resolve, reject){
                setTimeout(()=>{
                  resolve();
                }, 1500);
              }
            );
            return promise;
          }
        });
</script>
</footer>
<script>
includeHTML();
</script>
</html>
