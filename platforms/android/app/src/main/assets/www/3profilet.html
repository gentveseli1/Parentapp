<script src="js/base_urlJS.js"></script>
<script src="js/includeJS.js"></script>
<script src="js/pulltorefresh.js"></script>
<!DOCTYPE html>
<html>
<head>
<script src="js/sidebar.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/styles2.css" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Heebo:300,400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="css/sidebar.css" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src='https://kit.fontawesome.com/a076d05399.js'></script>
  <title>PROFILET.MOB</title>

</head>
<body>

     <div class="container-fluid" id="container-fluid">
    <div inculdeWithHTML="sidebar.html"></div>
        <p class="txttype">Profilet</p>
        
        <div class="profilet container-fluid">
         
        </div>

        <div class="row button-r">
          <!-- <button type="button" class="btn formkyqu" id="myBtn">+ Shto Profil</button> -->
          <button id="btnCam" type="button" class="btn mt-3" data-toggle="modal" data-target="#myModal">+ Shto Profil </button>
        </div>
    </div>
    
    <div class="modal" id="myModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <!-- Modal body -->
          <div class="modal-body">
            <video id="preview"></video>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer" style="justify-content: center;">
            <button type="button" class="btn btn-danger" id="close" data-dismiss="modal">Mbylle</button>
          </div>

        </div>
      </div>
    </div>
    
</body>
<footer>


  <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
  <script src="cordova.js"></script>
    <script type="text/javascript">
    var token = localStorage.getItem('token')

    if(token==null){
      window.location.href='index.html';
    }

    $(document).on("click",".student",function() {
      student_id = $(this).attr('id');
    });

      $.ajax({
        url: globalURL+'profiles',
        type: 'POST',
        headers:{
          'Authorization': 'Bearer ' + token,
          'Accept' : 'application/json',
        },
        data: {
				  student_id: '1',
			  },
        success: function (data) {
        data.forEach(row => {
          $('.profilet').append('<div class="mb-2 divstudentat" style="justify-content: center;"><a style="text-decoration:none; display: flex;" href="4orari.html?='+row.id+'"><p class="profilfont"><img src="'+globalIMGURL+row.profile_image+'" class="imgradius">'+row.name+'</p></a></div>');
        });
          
        },
        error: function (error) {
        }
      });
  </script>
  <script>
    let app = {
    permissions: null,
    init: function () {
        //plugins ready
        document.addEventListener('deviceready', this.onDeviceReady.bind(this), false);
    },
    onDeviceReady: function() {
      app.permissions = cordova.plugins.permissions;
      document.getElementById('btnCam').addEventListener('click', app.camPerm);
    },
    camPerm: function () {
        app.permissions.checkPermission("android.permission.CAMERA", function (status) {
            // if (!status.hasPermission) {
                app.permissions.requestPermission("android.permission.CAMERA", function (status) {
                  // alert('success requesting CAMERA permission');
                  scanner();
                }, function (err) {
                  alert('failed to set permission');
                });
            // }
        }, function (err) {
          // alert(err);
        });
    }
    
  }
  app.init();
  
  function scanner() {
    // alert('scanner');
    var name;
    var birthdate;
    var school;
    var classa;
    var scheduleTime;
    var scheduleHours;
    var parentName;
    var protocol;
    var qrcode; 
    let scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });
    console.log(scanner);
    
    scanner.addListener('scan', function (content) {
      var data = [];
      data = content.split('%');
      protocol = data[0];
      qrcode = data[1];
      name = data[2];
      birthdate = data[3];
      parentName = data[4];
      school = data[5];
      classa = data[6];
      scheduleTime = data[7];
      scheduleHours = data[8];
      $.ajax({
        url: globalURL+'addstudent',
        type: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Accept' : 'application/json',
        },
        data: {
          protocol:protocol, qrcode:qrcode, name:name, birthdate:birthdate, parentName:parentName, school_id:school, class:classa, scheduleTime:scheduleTime, scheduleHours:scheduleHours
        },
        success: function (data) {
            $('#close').click()
            $('.divstudentat').remove()
            $.ajax({
              url: globalURL+'profiles',
              type: 'POST',
              headers:{
              'Authorization': 'Bearer ' + token,
              'Accept' : 'application/json',
              },
              data: {
              student_id: '1',
              },
              success: function (data) {
                data.forEach(row => {
                  $('.profilet').append('<div class="container-fluid d-flex divstudentat"><a style="text-decoration:none; display: flex;" href="4orari.html?='+row.id+'"><img src="'+globalIMGURL+row.profile_image+'" class="imgradius"><p class="profilfont">'+row.name+'</p></a></div>');
                });
              },
              error: function (error) {
                // alert(JSON.stringify(error));
              }
            });
        },
        error: function (error) {
          // alert(JSON.stringify(error));
        }
      });
    });
    Instascan.Camera.getCameras().then(function (cameras) {
      // alert(JSON.stringify(cameras));
      if (cameras.length > 0) {
        scanner.start(cameras[2]);
      } else {
        // alert('No cameras found.');
      }
    }).catch(function (e) {
      // alert(JSON.stringify(e+'xxx'));
    });
  }
 
    function hamburgerClick(){
      $('.bbros-side-bar').css('left','0')
      $('.bbros-close').css({'opacity':'1','visibility':'visible'})
      $('.bbros-close').css({'display': 'flex'})
    }
    function hamburgerClose(){
      $('.bbros-side-bar').css('left','-75%')
      $(this).css({'opacity':'0','visibility':'hidden'})
      $('.bbros-close').css({'display': 'none'})
    }

    PullToRefresh.init({
        mainElement: '#container-fluid', // above which element?
        onRefresh: function(){
          var promise = new Promise(
            function(resolve, reject){
              setTimeout(()=>{
                resolve();
              }, 1500);
            }
          );
          return promise;
        }
      });
</script>
<script>
includeHTML();
</script>
  </footer>
</html>
