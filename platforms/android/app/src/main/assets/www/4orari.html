<script src="js/base_urlJS.js"></script>
<script src="js/includeJS.js"></script>
<script src="js/pulltorefresh.js"></script>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Heebo:300,400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="css/styles3.css" type="text/css">
  <link rel="stylesheet" href="css/sidebar.css" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src='https://kit.fontawesome.com/a076d05399.js'></script>
  <title>ORARI.MOB</title>
</head>
<body>
      <div class="container-fluid mt-4" id="container-fluid" align="center"> 
        <div inculdeWithHTML="sidebar.html"></div>
        <div class="container student">

        </div>
        <!-- <div class="loadersmall"></div> -->
      </div>
</body>
<footer>
  <script src="js/sidebar.js"></script>
  <script type="text/javascript">
    $(document).ready(function(e) {
    $(window).on('load', function() {
      // Animate loader off screen
      $(".loadersmall").fadeOut("slow");;
    });


    function fasterPreview( uploader ) {
      alert('hini');
        if ( uploader.files && uploader.files[0] ){
              $('#profileImage').attr('src', 
                window.URL.createObjectURL(uploader.files[0])
              );
        }
    }


    var token = localStorage.getItem("token")

    if(token==null){
      window.location.href='index.html';
    }
    
    $.ajaxSetup({
        headers: {
            'Authorization': 'Bearer ' + token,
            'Accept' : 'application/json',
        },
    });

    var url = window.location.href;
    var student_id = url.substr(url.indexOf("=") + 1)

    $.ajax({
      url: globalURL+'get_student',
      type: 'POST',
      data: { student_id:student_id},

      success: function (data) {

        if(data.profile_image == null){
          $('.student').append('<div id="image_preview"><img id="previewing" src="noimage.png" /></div><div id="profile-container"><input id="imageUpload" type="file" name="profile_photo" placeholder="Photo" required="" capture><input type="button" value="upload" id ="uploadPhotoButton"/></div><input readonly type="text" value="'+data.name+'" class="form-control margtop2" placeholder="Emri dhe Mbiemri"><input readonly type="text" value="'+data.birthdate+'" class="form-control margtop" placeholder="Ditëlindja e nxënësit"><input readonly type="text" value="'+data.schoolName+'" class="form-control margtop" placeholder="Shkolla"><input readonly type="text" value= "'+data.class+'" class="form-control margtop" placeholder="Klasa"><div class="orari d-flex" align="center"><p class="textchange">Orari i Mesimit<br>'+data.orariMesimit+'</p></div>')
        }

        $('.student').append('<div id="profile-container"><image id="profileImage" src="'+globalIMGURL+data.profile_image+'"/><input id="imageUpload" type="file" name="profile_photo" placeholder="Photo" required="" capture></div><input readonly type="text" value="'+data.name+'" class="form-control mt-5" placeholder="Emri dhe Mbiemri"><input readonly type="text" value="'+data.birthdate+'" class="form-control margtop" placeholder="Ditëlindja e nxënësit"><input readonly type="text" value="'+data.schoolName+'" class="form-control margtop" placeholder="Shkolla"><input readonly type="text" value="'+data.class+'" class="form-control margtop" placeholder="Klasa"><div class="orari d-flex" align="center"><p class="textchange">Orari i Mësimit<br>'+data.orariMesimit+'</p</div>')

      },
      error: function (error) {
        window.location.href = '3profilet.html'
        console.log(error);
      }
    });

    $("body").on('change', '#imageUpload' , function(e){

                event.preventDefault();
                var files = $('#imageUpload')[0].files[0];

                var formData = new FormData();
                formData.append('profile_image',  files , $.now()+'.jpg');
                formData.append('student_id',student_id);
                $.ajax({
                    url: globalURL + 'change_picture', 
                    type: "POST", 
                    contentType: false,
                    processData: false,
                    data: formData,
                    success: function(data)
                    {
                      location.reload();
                    },
                    error: function (error) {
                      alert('something went wrong');
                      window.location.href = '3profilet.html'
                      JSON.stringify(error);
                    }
                });
            });
        });

        PullToRefresh.init({
          mainElement: '#container-fluid', // above which element?
          onRefresh: function(){
            var promise = new Promise(
              function(resolve, reject){
                setTimeout(()=>{
                  resolve();
                }, 1500);
              }
            );
            return promise;
          }
        });
   
  </script>
</footer>
<script>
includeHTML();
</script>
</html>
